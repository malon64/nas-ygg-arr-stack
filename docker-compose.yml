networks:
  media-net:
    driver: bridge

x-common-env: &common-env
  PUID: "${PUID}"
  PGID: "${PGID}"
  TZ: "${TZ}"

x-logging: &common-logging
  driver: "json-file"
  options:
    max-size: "${DOCKERLOGGING_MAXSIZE}"
    max-file: "${DOCKERLOGGING_MAXFILE}"

services:
  vpn:
    image: qmcgaw/gluetun:latest
    container_name: vpn
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      <<: *common-env
      VPN_SERVICE_PROVIDER: "nordvpn"
      VPN_TYPE: "openvpn"
      OPENVPN_USER: "${NORDVPN_USER}"
      OPENVPN_PASSWORD: "${NORDVPN_PASSWORD}"
      OPENVPN_CUSTOM_CONFIG: "${OPENVPN_CUSTOM_CONFIG:-}"
      SERVER_COUNTRIES: "${SERVER_COUNTRIES:-France}"
      FIREWALL_INPUT_PORTS: "${QBITTORRENT_WEBUI_PORT}"
    volumes:
      - ${DOCKERCONFDIR}/vpn:/config
    ports:
      - "${QBITTORRENT_WEBUI_PORT}:${QBITTORRENT_WEBUI_PORT}"
    restart: unless-stopped
    logging: *common-logging
    networks:
      - media-net

  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    network_mode: "service:vpn"
    depends_on:
      - vpn
    environment:
      <<: *common-env
      WEBUI_PORT: "${QBITTORRENT_WEBUI_PORT}"
    volumes:
      - ${DOCKERCONFDIR}/qbittorrent:/config
      - ${ARR_DATA_DIR}:/arr-data
    restart: unless-stopped
    logging: *common-logging

  jackett:
    image: lscr.io/linuxserver/jackett:latest
    container_name: jackett
    environment:
      <<: *common-env
    volumes:
      - ${DOCKERCONFDIR}/jackett:/config
    networks:
      - media-net
    ports:
      - "${JACKETT_PORT}:${JACKETT_PORT}"
    restart: unless-stopped
    logging: *common-logging

  flaresolverr:
    image: flaresolverr/flaresolverr:latest
    container_name: flaresolverr
    networks:
      - media-net
    environment:
      <<: *common-env
      LOG_LEVEL: info
    shm_size: "2gb"
    ports:
      - "${FLARESOLVERR_PORT}:${FLARESOLVERR_PORT}"
    restart: unless-stopped
    logging: *common-logging

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      <<: *common-env
    volumes:
      - ${DOCKERCONFDIR}/prowlarr:/config
    ports:
      - "${PROWLARR_PORT}:${PROWLARR_PORT}"
    networks:
      - media-net
    restart: unless-stopped
    logging: *common-logging

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    environment:
      <<: *common-env
    volumes:
      - ${DOCKERCONFDIR}/radarr:/config
      - ${ARR_DATA_DIR}:/arr-data
    ports:
      - "${RADARR_PORT}:${RADARR_PORT}"
    networks:
      - media-net
    restart: unless-stopped
    logging: *common-logging

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    environment:
      <<: *common-env
    volumes:
      - ${DOCKERCONFDIR}/sonarr:/config
      - ${ARR_DATA_DIR}:/arr-data
    ports:
      - "${SONARR_PORT}:${SONARR_PORT}"
    networks:
      - media-net
    restart: unless-stopped
    logging: *common-logging

  plex:
    image: lscr.io/linuxserver/plex:latest
    container_name: plex
    network_mode: host
    environment:
      <<: *common-env
      VERSION: docker
    volumes:
      - ${DOCKERCONFDIR}/plex:/config
      - ${MEDIA_MOVIES_HOST_DIR}:/data/movies
      - ${MEDIA_SHOWS_HOST_DIR}:/data/shows
    restart: unless-stopped
    logging: *common-logging

  watchlistarr:
    image: nylonee/watchlistarr:latest
    container_name: watchlistarr
    environment:
      SONARR_API_KEY: "${SONARR_API_KEY}"
      RADARR_API_KEY: "${RADARR_API_KEY}"
      PLEX_TOKEN: "${WATCHLISTARR_PLEX_TOKEN}"
      LOG_LEVEL: "${WATCHLISTARR_LOG_LEVEL}"
    volumes:
      - ${DOCKERCONFDIR}/watchlistarr:/app/config
    depends_on:
      - sonarr
      - radarr
    networks:
      - media-net
    restart: unless-stopped
    logging: *common-logging

  ygege:
    image: uwucode/ygege:stable-noupx
    container_name: ygege
    environment:
      BIND_IP: "0.0.0.0"
      BIND_PORT: "${YGEGE_PORT}"
      LOG_LEVEL: "${YGEGE_LOG_LEVEL}"
    volumes:
      - ${DOCKERCONFDIR}/ygege/config.json:/app/config.json
      - ${DOCKERCONFDIR}/ygege/sessions:/app/sessions
    ports:
      - "${YGEGE_PORT}:${YGEGE_PORT}"
    networks:
      - media-net
    restart: unless-stopped
    logging: *common-logging
